<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Study App Auth - Water Wave Mode Switch</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
  <link href="https://fonts.googleapis.com/css?family=Inter:400,600&display=swap" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/airbnb.css">
  <style>
  html, body {
  height: 100%;
  margin: 0;
  padding: 0;
  font-family: 'Inter', Arial, sans-serif;
  background: #e0e7ff;
  overflow: hidden;
}
body {
  min-height: 100vh;
  min-width: 100vw;
  background: radial-gradient(ellipse at 50% 30%, #e0e7ff 60%, #c7d2fe 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background 0.5s;
}

#modeSwitchBtn {
  position: fixed;
  top: 22px;
  right: 28px;
  z-index: 1002;
  background: #fff;
  border-radius: 50%;
  box-shadow: 0 2px 16px #6366f133, 0 0 0 2px #6366f1;
  width: 54px; height: 54px;
  display: flex; align-items: center; justify-content: center;
  cursor: pointer;
  transition: background 0.2s, box-shadow 0.2s;
  user-select: none;
}
#modeSwitchBtn:hover {
  background: #6366f1;
}
#modeSwitchBtn:hover svg circle {
  fill: #fff;
}
#modeSwitchBtn:hover svg path {
  stroke: #6366f1;
}
#modeSwitchIcon {
  pointer-events: none;
}
#modeWave {
  position: fixed;
  left: 0; top: 0; width: 100vw; height: 100vh;
  pointer-events: none;
  z-index: 2000;
  opacity: 0;
  transition: opacity 0.3s;
  will-change: opacity;
}
#modeWave svg {
  width: 100vw;
  height: 100vh;
  display: block;
  position: absolute;
  left: 0; top: 0;
  pointer-events: none;
}
body {
  --main-bg: #e0e7ff;
  --main-bg2: #c7d2fe;
  --floor-bg: #b4b8d6;
  --floor-bg2: #e0e7ff;
  --shadow: #6366f155;
  --box-bg: #e0e7ff;
  --box-shadow1: #b6b9d6;
  --box-shadow2: #fff;
  --box-shadow3: #fff4;
  --box-shadow4: #dbeafe;
  --logo-bg: #e0e7ff;
  --logo-border: #dbeafe;
  --logo-shadow1: #6366f1;
  --logo-shadow2: #818cf8cc;
  --logo-shadow3: #b6b9d6;
  --logo-shadow4: #fff;
  --logo-shadow5: #fff4;
  --title: #3730a3;
  --title-shadow1: #b6b9d6;
  --title-shadow2: #fff8;
  --input-bg: #e0e7ff;
  --input-color: #222;
  --input-shadow1: #b6b9d6;
  --input-shadow2: #fff;
  --input-shadow3: #fff4;
  --input-focus-bg: #f1f5f9;
  --input-focus-shadow1: #b6b9d6;
  --input-focus-shadow2: #fff;
  --input-focus-shadow3: #6366f122;
  --btn-bg: linear-gradient(90deg, #6366f1 10%, #818cf8 90%);
  --btn-color: #fff;
  --btn-shadow1: #b6b9d6;
  --btn-shadow2: #fff;
  --msg: #3730a3;
  --msg-shadow: #b6b9d6;
  --switch-link: #6366f1;
  --profile-border: #dbeafe;
  --profile-bg: #f3f4f6;
  --profile-shadow1: #b6b9d6;
  --profile-shadow2: #fff;
  --popup-bg: #fff;
  --popup-shadow: #3730a355;
  --popup-close-bg: #fff;
  --popup-close-shadow: #6366f122;
  --popup-close-hover-bg: #6366f1;
  --popup-close-path: #6366f1;
  --popup-close-hover-path: #fff;
  --click-here: #6366f1;
  --click-here-bg: none;
  --click-here-weight: 700;
  --click-here-size: 1em;
  --click-here-cursor: default;
  --click-here-padding: 0 8px 0 0;
}
body.dark-mode {
  background:
    linear-gradient(120deg, #181c2f 60%, #23243a 100%),
    url('https://www.transparenttextures.com/patterns/diamond-upholstery.png');
  --main-bg: #1a1d2b;
  --main-bg2: #23243a;
  --floor-bg: #23243a;
  --floor-bg2: #181c2f;
  --shadow: #23243aee;
  --box-bg: #202233;
  --box-shadow1: 12px 12px 32px #151624cc, -12px -12px 32px #23243a99, 0 1.5px 0 #2d2e4a inset, 0 0 0 2px #2d2e4a;
  --box-shadow2: 0 0 0 0 transparent;
  --box-shadow3: 0 1.5px 0 #23243a inset;
  --box-shadow4: 0 0 0 2px #6366f1;
  --logo-bg: #23243a;
  --logo-border: #6366f1;
  --logo-shadow1: #6366f1;
  --logo-shadow2: #818cf8cc;
  --logo-shadow3: #181c2f;
  --logo-shadow4: #23243a;
  --logo-shadow5: #23243a;
  --title: #c7d2fe;
  --title-shadow1: #6366f1;
  --title-shadow2: #23243a;
  --input-bg: #23243a;
  --input-color: #e0e7ff;
  --input-shadow1: 6px 6px 16px #181c2f, -6px -6px 16px #23243a;
  --input-shadow2: 0 1.5px 0 #6366f1 inset;
  --input-shadow3: 0 0 0 2px #6366f1;
  --input-focus-bg: #1a1d2b;
  --input-focus-shadow1: 0 0 0 2px #818cf8;
  --input-focus-shadow2: 0 0 0 4px #6366f122;
  --input-focus-shadow3: 0 0 0 2px #6366f1;
  --btn-bg: linear-gradient(90deg, #6366f1 10%, #818cf8 90%);
  --btn-color: #fff;
  --btn-shadow1: 6px 6px 16px #181c2f, -6px -6px 16px #23243a;
  --btn-shadow2: 0 0 0 2px #6366f1;
  --msg: #a5b4fc;
  --msg-shadow: #6366f1;
  --switch-link: #a5b4fc;
  --profile-border: #6366f1;
  --profile-bg: #23243a;
  --profile-shadow1: 2px 2px 8px #181c2f;
  --profile-shadow2: -2px -2px 8px #23243a;
  --popup-bg: rgba(32,34,51,0.95);
  --popup-shadow: 0 8px 40px #181c2f99, 0 0 0 2px #6366f1;
  --popup-close-bg: #181c2f;
  --popup-close-shadow: 0 2px 8px #6366f1;
  --popup-close-hover-bg: #6366f1;
  --popup-close-path: #a5b4fc;
  --popup-close-hover-path: #fff;
  --click-here: #a5b4fc;
  --click-here-bg: none;
  --click-here-weight: 700;
  --click-here-size: 1em;
  --click-here-cursor: default;
  --click-here-padding: 0 8px 0 0;
}
.login-3d-box.signup-complete {
  background: #b4b8d6 !important;
  transition: background 0.3s;
}
/* Neomorphic box shadow for cards */
body.dark-mode .login-3d-box {
  background: var(--box-bg);
  border-radius: 32px;
  box-shadow:
    0 2px 24px 0 #181c2f,
    0 8px 48px 0 #23243a99,
    0 0 0 2px #6366f1;
  border: none;
  transition: box-shadow 0.3s, background 0.5s;
}
/* Neomorphic input fields */
body.dark-mode .login-3d-fields input[type="text"],
body.dark-mode .login-3d-fields input[type="password"] {
  background: var(--input-bg);
  color: var(--input-color);
  box-shadow:
    0 2px 8px #181c2f,
    0 1.5px 0 #6366f1 inset;
  border-radius: 14px;
  border: none;
  transition: box-shadow 0.2s, background 0.2s, color 0.5s;
}
/* Neomorphic button */
body.dark-mode .login-3d-btn {
  box-shadow:
    6px 6px 16px #181c2f,
    -6px -6px 16px #23243a,
    0 0 0 2px #6366f1;
  border-radius: 16px;
  background: var(--btn-bg);
  color: var(--btn-color);
  transition: box-shadow 0.2s, background 0.5s, color 0.5s;
}
/* Glassy popup */
body.dark-mode .popup-content {
  background: var(--popup-bg);
  box-shadow: 0 8px 40px #181c2f99, 0 0 0 2px #6366f1;
  backdrop-filter: blur(8px) saturate(1.2);
  border-radius: 32px;
}
/* Add a subtle noise overlay for realism */
body.dark-mode::before {
  content: "";
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 0;
  opacity: 0.13;
  background: url('https://www.transparenttextures.com/patterns/diamond-upholstery.png');
  mix-blend-mode: soft-light;
}
/* Softer shadow for the floor */
body.dark-mode .room-floor {
  box-shadow: 0 -8px 32px #23243aee inset;
  background: linear-gradient(0deg, #23243a 0%, #181c2f 100%);
}
/* Softer shadow for the card shadow */
body.dark-mode .room-shadow {
  background: radial-gradient(ellipse at center, #6366f1cc 0%, #0000 80%);
  filter: blur(8px);
  opacity: 0.5;
}
/* --- Glowing Logo --- */
.login-3d-logo {
  width: 56px;
  height: 56px;
  border-radius: 16px;
  background: var(--logo-bg);
  object-fit: cover;
  border: 2px solid var(--logo-border);
  display: block;
  box-shadow:
    0 0 0 0 var(--logo-shadow1),
    0 0 16px 4px var(--logo-shadow2),
    4px 4px 12px var(--logo-shadow3),
    -4px -4px 12px var(--logo-shadow4),
    0 1.5px 0 var(--logo-shadow5) inset;
  z-index: 2;
  position: relative;
  cursor: pointer;
  transition: box-shadow 0.2s, transform 0.2s, background 0.5s, border 0.5s;
  animation: logoGlow 1.2s infinite alternate;
}
@keyframes logoGlow {
  0% {
    box-shadow:
      0 0 0 0 var(--logo-shadow1),
      0 0 16px 4px var(--logo-shadow2),
      4px 4px 12px var(--logo-shadow3),
      -4px -4px 12px var(--logo-shadow4),
      0 1.5px 0 var(--logo-shadow5) inset;
  }
  100% {
    box-shadow:
      0 0 0 12px var(--logo-shadow1),
      0 0 32px 16px var(--logo-shadow2),
      4px 4px 12px var(--logo-shadow3),
      -4px -4px 12px var(--logo-shadow4),
      0 1.5px 0 var(--logo-shadow5) inset;
  }
}
body.dark-mode .login-3d-logo {
  box-shadow:
    0 0 0 0 #6366f1,
    0 0 32px 8px #6366f1cc,
    0 0 64px 24px #818cf8cc,
    4px 4px 16px #181c2f,
    -4px -4px 16px #23243a,
    0 1.5px 0 #23243a inset;
  animation: logoGlowDark 1.4s infinite alternate;
}
@keyframes logoGlowDark {
  0% {
    box-shadow:
      0 0 0 0 #6366f1,
      0 0 32px 8px #6366f1cc,
      0 0 64px 24px #818cf8cc,
      4px 4px 16px #181c2f,
      -4px -4px 16px #23243a,
      0 1.5px 0 #23243a inset;
  }
  100% {
    box-shadow:
      0 0 0 18px #6366f1,
      0 0 64px 32px #6366f1cc,
      0 0 128px 48px #818cf8cc,
      4px 4px 16px #181c2f,
      -4px -4px 16px #23243a,
      0 1.5px 0 #23243a inset;
  }
}
/* --- Shared Styles using CSS Variables --- */
.room-floor {
  position: absolute;
  left: 0; right: 0; bottom: 0;
  height: 32vh;
  background: linear-gradient(0deg, var(--floor-bg) 0%, var(--floor-bg2) 100%);
  z-index: 0;
  border-top-left-radius: 60vw 10vh;
  border-top-right-radius: 60vw 10vh;
  box-shadow: 0 -8px 32px var(--shadow) inset;
  opacity: 0.85;
  transition: background 0.5s, box-shadow 0.5s;
}
.room-shadow {
  position: absolute;
  left: 50%; bottom: 18vh;
  width: 260px; height: 48px;
  background: radial-gradient(ellipse at center, var(--shadow) 0%, #0000 80%);
  transform: translateX(-50%) scaleY(1.1);
  filter: blur(4px);
  z-index: 2;
  pointer-events: none;
  opacity: 0.7;
  transition: left 0.2s, width 0.2s, opacity 0.2s, background 0.5s;
}
.login-3d-container {
  perspective: 1600px;
  width: 100vw;
  
  transform: translateY(-1vh);

  height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 3;
  position: relative;
}
.login-3d-box {
  background: var(--box-bg);
  border-radius: 32px;
  box-shadow:
    8px 8px 24px var(--box-shadow1),
    -8px -8px 24px var(--box-shadow2),
    0 1.5px 0 var(--box-shadow3) inset,
    0 0 0 1.5px var(--box-shadow4);
  border: none;
  padding: 38px 24px 28px 24px;
  min-width: 320px;
  max-width: 92vw;
  width: 350px;
  display: flex;
  flex-direction: column;
  align-items: center;
  transform-style: preserve-3d;
  animation: pop3d 1.1s cubic-bezier(.68,-0.55,.27,1.55);
  position: relative;
  transition: box-shadow 0.3s, transform 0.2s, background 0.5s;
  will-change: transform;
  z-index: 10;
  overflow: visible;
}
@keyframes pop3d {
  0% { transform: rotateY(30deg) scale(0.7) translateY(60px); opacity: 0; }
  80% { transform: rotateY(-8deg) scale(1.05) translateY(-8px); opacity: 1; }
  100% { transform: rotateY(0deg) scale(1) translateY(0); opacity: 1; }
}
.logo-row {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  margin-bottom: 18px;
  gap: 12px;
}
.click-here-txt {
  color: var(--click-here);
  font-weight: var(--click-here-weight);
  font-size: var(--click-here-size);
  background: var(--click-here-bg);
  border: none;
  outline: none;
  cursor: var(--click-here-cursor);
  padding: var(--click-here-padding);
  user-select: none;
  transition: opacity 0.3s, color 0.5s;
}
.login-3d-title {
  font-size: 1.25em;
  font-weight: 800;
  color: var(--title);
  letter-spacing: .04em;
  margin-bottom: 18px;
  text-shadow:
    0 2px 4px var(--title-shadow1),
    0 1px 0 var(--title-shadow2);
  text-align: center;
  z-index: 2;
  position: relative;
  transition: color 0.5s, text-shadow 0.5s;
}
.login-3d-fields {
  width: 100%;
  display: flex;
  flex-direction: column;
  gap: 14px;
  margin-bottom: 18px;
  align-items: center;
}
.login-3d-fields input[type="text"],
.login-3d-fields input[type="password"] {
  width: 100%;
  min-width: 0;
  max-width: 100%;
  box-sizing: border-box;
  padding: 13px 16px;
  border-radius: 12px;
  border: none;
  font-size: 1.08em;
  background: var(--input-bg);
  color: var(--input-color);
  outline: none;
  box-shadow:
    4px 4px 12px var(--input-shadow1),
    -4px -4px 12px var(--input-shadow2),
    0 1.5px 0 var(--input-shadow3) inset;
  font-family: inherit;
  font-weight: 500;
  transition: box-shadow .2s, background .2s, color 0.5s;
  display: block;
}
.login-3d-fields input:focus {
  background: var(--input-focus-bg);
  box-shadow:
    2px 2px 6px var(--input-focus-shadow1),
    -2px -2px 6px var(--input-focus-shadow2),
    0 2px 8px var(--input-focus-shadow3);
}
.login-3d-fields input[type="file"] {
  margin-top: 4px;
  font-size: 0.98em;
  border: none;
  background: none;
  box-shadow: none;
  color: var(--title);
}
.profile-img-preview {
  width: 70px;
  height: 70px;
  border-radius: 50%;
  object-fit: cover;
  margin: 8px auto 0 auto;
  display: block;
  border: 2px solid var(--profile-border);
  background: var(--profile-bg);
  box-shadow:
    2px 2px 8px var(--profile-shadow1),
    -2px -2px 8px var(--profile-shadow2);
  transition: border 0.5s, background 0.5s;
}
.login-3d-btn {
  margin-top: 8px;
  width: 100%;
  min-width: 0;
  max-width: 100%;
  box-sizing: border-box;
  background: var(--btn-bg);
  color: var(--btn-color);
  border: none;
  border-radius: 14px;
  padding: 13px 0;
  font-size: 1.12em;
  font-weight: 700;
  box-shadow:
    4px 4px 12px var(--btn-shadow1),
    -4px -4px 12px var(--btn-shadow2);
  cursor: pointer;
  opacity: 0.96;
  letter-spacing: .04em;
  transition: opacity .2s, box-shadow .2s, transform .1s, background 0.5s, color 0.5s;
  display: block;
}
.login-3d-btn:active {
  opacity: 1;
  box-shadow:
    2px 2px 6px var(--btn-shadow1),
    -2px -2px 6px var(--btn-shadow2);
  transform: scale(0.98);
}
.login-3d-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}
.login-3d-msg {
  min-height: 20px;
  text-align: center;
  color: var(--msg);
  font-weight: 600;
  margin-top: 10px;
  text-shadow: 0 2px 8px var(--msg-shadow);
  letter-spacing: .02em;
  font-size: 1em;
  transition: color 0.2s;
}
.switch-link {
  margin-top: 14px;
  font-size: 0.98em;
  color: var(--switch-link);
  text-align: center;
  cursor: pointer;
  text-decoration: underline;
  transition: color 0.5s;
}
.hide { display: none !important; }
.input-error {
  box-shadow: 0 0 0 2px #dc2626, 4px 4px 12px var(--box-shadow1), -4px -4px 12px var(--box-shadow2), 0 1.5px 0 var(--box-shadow3) inset !important;
  background: #fee2e2 !important;
  animation: shake 0.18s 2;
}
@keyframes shake {
  0% { transform: translateX(0);}
  25% { transform: translateX(-4px);}
  50% { transform: translateX(4px);}
  75% { transform: translateX(-4px);}
  100% { transform: translateX(0);}
}
.profile-popup {
  position: fixed;
  inset: 0;
  background: rgba(30, 41, 59, 0.18);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.35s;
}
.profile-popup.open {
  opacity: 1;
  pointer-events: auto;
}
.popup-content {
  position: relative;
  background: var(--popup-bg);
  border-radius: 999px;
  box-shadow: 0 8px 40px var(--popup-shadow);
  width: 92vw;
  max-width: 420px;
  height: 70vh;
  max-height: 520px;
  display: flex;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  opacity: 0;
  transform: scale(0.3);
  transition: opacity 0.45s cubic-bezier(.68,-0.55,.27,1.55), transform 0.45s cubic-bezier(.68,-0.55,.27,1.55), transform-origin 0s;
  will-change: opacity, transform;
}
.profile-popup.open .popup-content {
  opacity: 1;
  transform: scale(1);
  pointer-events: auto;
}
.popup-iframe {
  flex: 1 1 auto;
  border: none;
  width: 100%;
  height: 100%;
  border-radius: 20px;
  background: #f3f4f6;
}
.popup-close {
  position: absolute;
  top: 10px; left: 10px;
  background: var(--popup-close-bg);
  border: none;
  border-radius: 50%;
  width: 38px; height: 38px;
  box-shadow: 0 2px 8px var(--popup-close-shadow);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  z-index: 2;
  transition: background 0.2s;
}
.popup-close:hover {
  background: var(--popup-close-hover-bg);
}
.popup-close svg path {
  transition: stroke 0.2s;
  stroke: var(--popup-close-path);
}
.popup-close:hover svg path {
  stroke: var(--popup-close-hover-path);
}
@media (max-width: 500px) {
  .login-3d-box { min-width: 90vw; width: 96vw; padding: 14px 2vw 10px 2vw;}
  .login-3d-logo { width: 40px; height: 40px; }
  .room-shadow { width: 120px; height: 22px; bottom: 14vh;}
  .login-3d-fields input, .login-3d-btn { max-width: 100vw; }
  .popup-content { max-width: 98vw; height: 80vh; }
}
.dob-label {
  display: block;
  margin-bottom: 4px;
  color: #a5b4fc;
  font-size: 1.01em;
  font-weight: 600;
  opacity: 0.8;
  letter-spacing: 0.01em;
  font-family: 'Inter', Arial, sans-serif;
}
.dob-field-wrap input[type="date"] {
  width: 100%;
  padding: 13px 16px;
  border-radius: 12px;
  border: none;
  font-size: 1.08em;
  background: #e0e7ff;
  color: #6366f1;
  outline: none;
  box-shadow:
    4px 4px 12px #b6b9d6,
    -4px -4px 12px #fff,
    0 1.5px 0 #fff4 inset;
  font-family: 'Inter', Arial, sans-serif;
  font-weight: 500;
  transition: box-shadow .2s, background .2s, color 0.5s;
  display: block;
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  cursor: pointer;
}
.dob-field-wrap input[type="date"]:focus {
  background: #f1f5fe;
  color: #6366f1;
  box-shadow:
    2px 2px 6px #b6b9d6,
    -2px -2px 6px #fff,
    0 2px 8px #6366f122;
}
  </style>
</head>
<body>
  
  <!-- ... all your HTML unchanged ... -->
  <div id="modeSwitchBtn" title="Switch UI Mode">
    <svg id="modeSwitchIcon" width="32" height="32" viewBox="0 0 32 32">
      <circle cx="16" cy="16" r="14" fill="#6366f1" stroke="#fff" stroke-width="2"/>
      <path d="M16 8v8l6 4" stroke="#fff" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
  </div>
  <div id="modeWave"></div>
  <div class="room-floor"></div>
  <div class="room-shadow"></div>
  <div class="login-3d-container">
    <!-- Signup Card -->
    <form class="login-3d-box" id="signupCard" autocomplete="off" onsubmit="return false;">
      <div class="logo-row">
        <span class="click-here-txt" id="clickHereTxt">Click here</span>
        <img src="Zenstudy.jpg" class="login-3d-logo" alt="logo">
      </div>
      <div class="login-3d-title" id="signupTitle">Sign Up</div>
      <div class="login-3d-fields">
  <input type="text" id="signupUser" placeholder="Create username" autocomplete="off" required>
<div class="dob-field-wrap">
  <label for="signupDOB" class="dob-label">Date of Birth</label>
  <input type="date" id="signupDOB" required autocomplete="off">
</div>
  <input type="password" id="signupPass" placeholder="Create password (min 6 chars)" autocomplete="off" required>

  <input type="file" id="profileImg" accept="image/*" required>
  <img id="profileImgPreview" class="profile-img-preview" style="display:none;">
</div>
      <button type="button" id="googleLoginBtn" class="login-3d-btn" style="margin-top:10px;background:#fff;color:#222;border:1px solid #6366f1;">
  <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" style="width:22px;vertical-align:middle;margin-right:8px;">
  <span id="googleBtnText">Sign in with Google</span>
</button>
<div id="googleAccountInfo" style="display:none; margin-top:18px; text-align:center;">
  <img id="googleUserPic" style="width:48px;height:48px;border-radius:50%;border:2px solid #6366f1;"><br>
  <span id="googleUserName" style="font-weight:700;"></span><br>
  <span id="googleUserEmail" style="font-size:0.98em;color:#6366f1;"></span>
</div>
      <div class="login-3d-msg" id="signupMsg"></div>
      <button class="login-3d-btn" id="signupBtn" type="button" disabled>Sign Up</button>
      <div class="switch-link" id="toLogin">Already have an account? Login</div>
    </form>
    <!-- Login Card -->
    <form class="login-3d-box hide" id="loginCard" autocomplete="off" onsubmit="return false;">
      <div class="logo-row">
        <span class="click-here-txt" id="clickHereTxt2">Click here</span>
        <img src="https://cdn-icons-png.flaticon.com/512/3135/3135755.png" class="login-3d-logo" alt="logo">
      </div>
      <div class="login-3d-title" id="loginTitle">Login</div>
      <div class="login-3d-fields">
        <input type="text" id="loginUser" placeholder="User ID" autocomplete="off" required>
    <input type="password" id="loginPass" placeholder="Password" autocomplete="off" required>
      </div>
      <button type="button" id="googleLoginBtn" class="login-3d-btn" style="margin-top:10px;background:#fff;color:#222;border:1px solid #6366f1;">
  <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" style="width:22px;vertical-align:middle;margin-right:8px;"> Sign in with Google
</button>
      <div class="login-3d-msg" id="loginMsg"></div>
      <button class="login-3d-btn" id="loginBtn" type="button" disabled>Login</button>
      <div class="switch-link" id="toSignup">Don't have an account? Sign Up</div>
    </form>
    
  </div>
  <!-- Popup Overlay -->
  <div id="profilePopup" class="profile-popup">
    <div class="popup-content">
      <button class="popup-close" id="popupCloseBtn" aria-label="Close">
        <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
          <path d="M20 24L12 16L20 8" stroke="#6366f1" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      <iframe src="help.html" frameborder="0" class="popup-iframe"></iframe>
    </div>
  </div>
  <script>

(function() {
  const lastUser = localStorage.getItem('last_logged_in_user');
  if (
    lastUser &&
    lastUser !== "null" &&
    lastUser !== "undefined" &&
    lastUser.trim() !== "" &&
    !window.location.search.includes('user=')
  ) {
    window.location.href = `jeeee.html?user=${encodeURIComponent(lastUser)}`;
  }
})();
// ...rest of your code continues here...
    // --- Water Wave Mode Switcher ---
    // ... (all your original JS for mode switch, 3D, popup, etc) ...
      // --- Water Wave Mode Switcher ---
    const modeSwitchBtn = document.getElementById('modeSwitchBtn');
    const modeSwitchIcon = document.getElementById('modeSwitchIcon');
    const modeWave = document.getElementById('modeWave');
    // Only two modes: Default and Modern Dark
    const modes = [
      {
        class: "",
        color: "#6366f1",
        tooltip: "Switch to Dark Mode"
      },
      {
        class: "dark-mode",
        color: "#818cf8",
        tooltip: "Switch to Light Mode"
      }
    ];
    let modeIndex = 0;
    function setMode(idx) {
      document.body.classList.remove("dark-mode");
      if (modes[idx].class) document.body.classList.add(modes[idx].class);
      // Update button color/icon/tooltip
      modeSwitchBtn.title = modes[idx].tooltip;
      modeSwitchIcon.querySelector("circle").setAttribute("fill", modes[idx].color);
    }
    setMode(0);

    // Water wave transition
    function waterWaveTransition(nextModeIdx, e) {
      // Get button center
      const btnRect = modeSwitchBtn.getBoundingClientRect();
      const cx = btnRect.left + btnRect.width/2;
      const cy = btnRect.top + btnRect.height/2;
      // Calculate max radius to cover screen
      const maxDist = Math.max(
        Math.hypot(cx, cy),
        Math.hypot(window.innerWidth-cx, cy),
        Math.hypot(cx, window.innerHeight-cy),
        Math.hypot(window.innerWidth-cx, window.innerHeight-cy)
      );
      // SVG wave path (wavy edge)
      function wavePath(r, waviness=18, waves=8) {
        let d = "";
        for (let i=0; i<=360; i+=2) {
          const rad = i * Math.PI/180;
          const wave = Math.sin(rad*waves) * waviness;
          const x = cx + (r+wave) * Math.cos(rad);
          const y = cy + (r+wave) * Math.sin(rad);
          d += (i===0 ? "M":"L") + x + "," + y + " ";
        }
        d += "Z";
        return d;
      }
      // Create SVG
      modeWave.innerHTML = `
        <svg>
          <path id="wavePath" fill="${nextModeIdx===1 ? '#6366f1' : '#fff'}" fill-opacity="0.92"/>
        </svg>
      `;
      modeWave.style.opacity = "1";
      const path = document.getElementById("wavePath");
      // Animate wave
      let r = 0, step = 0;
      const totalSteps = 38;
      function animateWave() {
        r = (step/totalSteps) * (maxDist+120);
        path.setAttribute("d", wavePath(r));
        if (step === Math.floor(totalSteps/2)) {
          setMode(nextModeIdx);
        }
        if (step < totalSteps) {
          step++;
          requestAnimationFrame(animateWave);
        } else {
          setTimeout(()=>{
            modeWave.style.opacity = "0";
          }, 180);
        }
      }
      animateWave();
    }
    modeSwitchBtn.onclick = function(e) {
      modeIndex = (modeIndex + 1) % modes.length;
      waterWaveTransition(modeIndex, e);
    };
   // --- 3D Card Animation: Mouse and Gyro ---
    function setup3d(cardSelector, shadowSelector) {
      const card = document.querySelector(cardSelector);
      let targetX = 0, targetY = 0, currentX = 0, currentY = 0, usingGyro = false, animating = false;
      let zeroGamma = null, zeroBeta = null;
      card.addEventListener('mousemove', e => {
        if (usingGyro) return;
        const rect = card.getBoundingClientRect();
        let mx = e.clientX - rect.left - rect.width/2;
        let my = e.clientY - rect.top - rect.height/2;
        targetX = mx/5;
        targetY = -my/5;
        if (!animating) animateCard();
      });
      card.addEventListener('mouseleave', () => {
        if (usingGyro) return;
        targetX = 0;
        targetY = 0;
        if (!animating) animateCard();
      });
      function handleOrientation(event) {
        usingGyro = true;
        let gamma = event.gamma || 0;
        let beta = event.beta || 0;
        if (zeroGamma === null || zeroBeta === null) {
          zeroGamma = gamma;
          zeroBeta = beta;
        }
        let dGamma = gamma - zeroGamma;
        let dBeta = beta - zeroBeta;
        dGamma = Math.max(-30, Math.min(30, dGamma));
        dBeta = Math.max(-30, Math.min(30, dBeta));
        targetX = dGamma * 1.2;
        targetY = -dBeta * 1.2;
        if (!animating) animateCard();
      }
      if (window.DeviceOrientationEvent) {
        window.addEventListener('deviceorientation', handleOrientation, true);
        card.addEventListener('mousemove', ()=>{
          usingGyro = false;
          zeroGamma = null; zeroBeta = null;
        });
      }
      function animateCard() {
        animating = true;
        currentX += (targetX - currentX) * 0.14;
        currentY += (targetY - currentY) * 0.14;
        card.style.transform = `rotateY(${currentX}deg) rotateX(${currentY}deg) scale3d(1.08,1.08,1.08)`;
        const shadow = document.querySelector(shadowSelector);
        if (shadow) {
          shadow.style.left = `calc(50% + ${-currentX*6}px)`;
          shadow.style.width = `${260 - Math.abs(currentY*4)}px`;
          shadow.style.opacity = `${0.7 - Math.abs(currentY/40)}`;
        }
        if (Math.abs(currentX-targetX) > 0.1 || Math.abs(currentY-targetY) > 0.1) {
          requestAnimationFrame(animateCard);
        } else {
          animating = false;
        }
      }
    }
    setup3d('#signupCard', '.room-shadow');
    setup3d('#loginCard', '.room-shadow');

    // UI Switch
    const signupCard = document.getElementById('signupCard');
    const loginCard = document.getElementById('loginCard');
    document.getElementById('toLogin').onclick = () => {
      signupCard.classList.add('hide');
      loginCard.classList.remove('hide');
      document.getElementById('loginUser').focus();
    };
    document.getElementById('toSignup').onclick = () => {
      loginCard.classList.add('hide');
      signupCard.classList.remove('hide');
      document.getElementById('signupUser').focus();
    };

    // --- Popup logic with shrink/fade to logo ---
    const popup = document.getElementById('profilePopup');
    const popupContent = popup.querySelector('.popup-content');
    const popupCloseBtn = document.getElementById('popupCloseBtn');
    const logoImgs = document.querySelectorAll('.login-3d-logo');
    const clickHereTxts = [document.getElementById('clickHereTxt'), document.getElementById('clickHereTxt2')];
  

    function getLogoCenter() {
      let logo = document.querySelector('.login-3d-logo:not(.hide)');
      if (!logo) logo = document.querySelector('.login-3d-logo');
      const rect = logo.getBoundingClientRect();
      return {
        x: rect.left + rect.width/2,
        y: rect.top + rect.height/2
      };
    }
    function setPopupOriginToLogo() {
      const logoCenter = getLogoCenter();
      const popupRect = popupContent.getBoundingClientRect();
      const originX = logoCenter.x - popupRect.left;
      const originY = logoCenter.y - popupRect.top;
      popupContent.style.transformOrigin = `${originX}px ${originY}px`;
    }
    function openPopup() {
      popup.classList.add('open');
      setPopupOriginToLogo();
      requestAnimationFrame(() => {
        popupContent.style.opacity = '1';
        popupContent.style.transform = 'scale(1)';
      });
    }
    function closePopup() {
      setPopupOriginToLogo();
      popupContent.style.opacity = '0';
      popupContent.style.transform = 'scale(0.3)';
      setTimeout(() => {
        popup.classList.remove('open');
      }, 450);
    }
    logoImgs.forEach(logo => {
      logo.style.cursor = 'pointer';
      logo.addEventListener('click', () => {
        clickHereTxts.forEach(txt => txt.style.display = 'none');
        if (popup.classList.contains('open')) {
          closePopup();
        } else {
          openPopup();
        }
      });
    });
    popupCloseBtn.addEventListener('click', closePopup);
    popup.addEventListener('click', e => {
      if (e.target === popup) closePopup();
    });
    popup.addEventListener('transitionend', () => {
      if (!popup.classList.contains('open')) {
        popupContent.style.opacity = '0';
        popupContent.style.transform = 'scale(0.3)';
      }
    });

    // --- Firebase Setup ---
    const firebaseConfig = {
      apiKey: "AIzaSyC9rehsf-0jkb9dAeT1-0Z1C-yRJ0YI9dA",
      authDomain: "gymnm-ce84b.firebaseapp.com",
      projectId: "gymnm-ce84b",
      storageBucket: "gymnm-ce84b.appspot.com",
      messagingSenderId: "474926929394",
      appId: "1:474926929394:web:6abdb807caba2751a5c76b",
      measurementId: "G-6R9S8LYZNF"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
firebase.auth().onAuthStateChanged(async function(user) {
  if (user) {
    // Already signed in with Google
    localStorage.setItem('last_logged_in_user', user.uid);
    window.location.href = `jeeee.html?user=${encodeURIComponent(user.uid)}`;
  }
});
    // --- Signup Logic ---
    const signupUser = document.getElementById('signupUser');
    const signupPass = document.getElementById('signupPass');
    const profileImg = document.getElementById('profileImg');
    const profileImgPreview = document.getElementById('profileImgPreview');
    const signupBtn = document.getElementById('signupBtn');
    const signupMsg = document.getElementById('signupMsg');
    const signupCardBox = document.getElementById('signupCard');
    const signupDOB = document.getElementById('signupDOB');
  let googleUser = null;
const googleLoginBtn = document.getElementById('googleLoginBtn');
const googleBtnText = document.getElementById('googleBtnText');
const googleAccountInfo = document.getElementById('googleAccountInfo');
const googleUserPic = document.getElementById('googleUserPic');
const googleUserName = document.getElementById('googleUserName');
const googleUserEmail = document.getElementById('googleUserEmail');

googleLoginBtn.onclick = async function() {
  const provider = new firebase.auth.GoogleAuthProvider();
  try {
    const result = await firebase.auth().signInWithPopup(provider);
    googleUser = result.user;
    // Show Google info in place of button
    googleLoginBtn.style.display = "none";
    googleAccountInfo.style.display = "block";
    googleUserPic.src = googleUser.photoURL || "";
    googleUserName.textContent = googleUser.displayName || "";
    googleUserEmail.textContent = googleUser.email || "";
    checkSignupFields();
  } catch (err) {
    signupMsg.textContent = "Google login error: " + err.message;
  }
};
    
  signupUser.oninput = signupPass.oninput = signupDOB.oninput = checkSignupFields;
profileImg.onchange = function() {
  if (profileImg.files && profileImg.files[0]) {
    const reader = new FileReader();
    reader.onload = function(e) {
      profileImgPreview.src = e.target.result;
      profileImgPreview.style.display = 'block';
      checkSignupFields();
    };
    reader.readAsDataURL(profileImg.files[0]);
  } else {
    checkSignupFields();
  }
};
function isAgeBetween7And21(dobStr) {
  if (!dobStr) return false;
  const dob = new Date(dobStr);
  const today = new Date();
  if (dob > today) return false; // future date not allowed
  let age = today.getFullYear() - dob.getFullYear();
  const m = today.getMonth() - dob.getMonth();
  const d = today.getDate() - dob.getDate();
  if (m < 0 || (m === 0 && d < 0)) age--;
  return age >= 7 && age <= 21;
}

function checkSignupFields() {
  const dob = signupDOB.value;
  const validAge = isAgeBetween7And21(dob);
  // Now require googleUser to be set!
  const allFilled = signupUser.value && signupPass.value.length >= 6 && profileImg.files.length > 0 && dob && validAge && googleUser;
  signupBtn.disabled = !allFilled;
  if (allFilled) {
    signupCardBox.classList.add('signup-complete');
    signupMsg.textContent = "";
  } else if (dob && !validAge) {
    signupMsg.textContent = "Please enter your correct date of birth (age must be between 7 and 21).";
  } else {
    signupCardBox.classList.remove('signup-complete');
    signupMsg.textContent = "";
  }
}
  signupBtn.onclick = async function() {
  // Final check before signup!
  const dob = signupDOB.value;
  const validAge = isAgeBetween7And21(dob);
  const allFilled = signupUser.value && signupPass.value.length >= 6 && profileImg.files.length > 0 && dob && validAge && googleUser;
  if (!allFilled) {
    signupMsg.textContent = "Please fill all fields and sign in with Google.";
    signupBtn.disabled = true;
    return;
  }
  signupBtn.disabled = true;
  signupMsg.textContent = "Signing up...";
  const file = profileImg.files[0];
  const reader = new FileReader();
  reader.onload = async function(e) {
    const imgBase64 = e.target.result;
    const userId = googleUser.uid; // Use Google UID!
    const userData = {
      userId: userId,
      username: signupUser.value.trim(),
      dob: signupDOB.value,
      password: signupPass.value,
      img: imgBase64,
      googleEmail: googleUser.email,
      googleName: googleUser.displayName,
      googlePhoto: googleUser.photoURL
    };
    try {
      await db.collection('users').doc(userId).set(userData);
      localStorage.setItem('user_' + userId, JSON.stringify(userData));
      localStorage.setItem('last_logged_in_user', userId);
      signupMsg.innerHTML = `Signup successful!<br>Redirecting...`;
      setTimeout(() => {
        window.location.href = `jeeee.html?user=${encodeURIComponent(userId)}`;
      }, 1200);
    } catch (err) {
      signupMsg.textContent = "Firebase error: " + err.message;
      signupBtn.disabled = false;
    }
  };
  reader.readAsDataURL(file);
};
loginBtn.onclick = async function() {
  loginBtn.disabled = true;
  loginMsg.textContent = "Logging in...";
  const userId = loginUser.value.trim();
  const password = loginPass.value;
  // Try LocalStorage first
  const localData = localStorage.getItem('user_' + userId);
  if (localData) {
    const user = JSON.parse(localData);
    if (user.password === password) {
      localStorage.setItem('last_logged_in_user', userId);
      window.location.href = `jeeee.html?user=${encodeURIComponent(userId)}`;
      return;
    }
  }
  // Try Firebase
  try {
    const doc = await db.collection('users').doc(userId).get();
    if (doc.exists) {
      const user = doc.data();
      if (user.password === password) {
        localStorage.setItem('last_logged_in_user', userId);
        window.location.href = `jeeee.html?user=${encodeURIComponent(userId)}`;
      } else {
        loginMsg.textContent = "Wrong password.";
        loginBtn.disabled = false;
      }
    } else {
      loginMsg.textContent = "User not found.";
      loginBtn.disabled = false;
    }
  } catch (err) {
    loginMsg.textContent = "Firebase error: " + err.message;
    loginBtn.disabled = false;
  }
};
function compressImage(base64, maxKB, callback) {
  const img = new Image();
  img.onload = function() {
    let w = img.width, h = img.height;
    const maxDim = 256;
    if (w > maxDim || h > maxDim) {
      if (w > h) {
        h = Math.round(h * maxDim / w);
        w = maxDim;
      } else {
        w = Math.round(w * maxDim / h);
        h = maxDim;
      }
    }
    const canvas = document.createElement('canvas');
    canvas.width = w;
    canvas.height = h;
    const ctx = canvas.getContext('2d');
    ctx.drawImage(img, 0, 0, w, h);
    let quality = 0.8;
    let compressed = canvas.toDataURL('image/jpeg', quality);
    while (compressed.length / 1024 > maxKB && quality > 0.2) {
      quality -= 0.1;
      compressed = canvas.toDataURL('image/jpeg', quality);
    }
    callback(compressed);
  };
  img.src = base64;
}
  
  googleLoginBtn.onclick = async function() {
  const provider = new firebase.auth.GoogleAuthProvider();
  try {
    const result = await firebase.auth().signInWithPopup(provider);
    googleUser = result.user;
    loadAndCompressGooglePhoto(googleUser.photoURL, function(compressedBase64) {
      googleUserPic.src = compressedBase64;
      googleUser.compressedPhoto = compressedBase64;
      googleLoginBtn.style.display = "none";
      googleAccountInfo.style.display = "block";
      googleUserName.textContent = googleUser.displayName || "";
      googleUserEmail.textContent = googleUser.email || "";
      checkSignupFields();
    });
  } catch (err) {
    signupMsg.textContent = "Google login error: " + err.message;
  }
};
  </script>
</body>
  </html>
